!function(e){var r={};function t(n){if(r[n])return r[n].exports;var u=r[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,t),u.l=!0,u.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var u in e)t.d(n,u,function(r){return e[r]}.bind(null,u));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="/",t(t.s=12)}([function(e,r,t){var n=t(6),u=t(5),s=n.define("user",{username:{type:u.STRING,primaryKey:!0},password:{type:u.STRING},description:{type:u.STRING},listings:{type:u.ARRAY(u.INTEGER)},karma:{type:u.INTEGER},subs:{type:u.ARRAY(u.STRING)},email:{type:u.STRING},followers:{type:u.ARRAY(u.STRING)},following:{type:u.ARRAY(u.STRING)},saved:{type:u.ARRAY(u.INTEGER)},createdAt:{type:u.STRING},votes:{type:u.JSON},moderator:{type:u.ARRAY(u.STRING)},session_ids:{type:u.STRING}});e.exports=s},function(e,r,t){var n=t(6),u=t(5),s=n.define("sub",{name:{type:u.STRING,primaryKey:!0},description:{type:u.STRING},users:{type:u.ARRAY(u.STRING)},listings:{type:u.ARRAY(u.INTEGER)},mods:{type:u.ARRAY(u.STRING)},createdBy:{type:u.STRING},createdAt:{type:u.STRING},rules:{type:u.JSON}});e.exports=s},function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function u(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){s(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function s(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var a=t(0),i=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.update(u({},t),{where:{username:r}});case 2:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(n,u){var s=e.apply(r,t);function a(e){o(s,n,u,a,i,"next",e)}function i(e){o(s,n,u,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=i},function(e,r){e.exports=require("express")},function(e,r,t){var n=t(6),u=t(5),s=n.define("listing",{id:{type:u.INTEGER,primaryKey:!0,autoIncrement:!0},user:{type:u.STRING},sub:{type:u.STRING},body:{type:u.STRING},isLink:{type:u.BOOLEAN},title:{type:u.STRING},ups:{type:u.ARRAY(u.STRING)},downs:{type:u.ARRAY(u.STRING)},score:{type:u.INTEGER,defaultValue:1},children:{type:u.ARRAY(u.INTEGER)},parent:{type:u.INTEGER},originalPost:{type:u.INTEGER},isNSFW:{type:u.BOOLEAN},isSpoiler:{type:u.BOOLEAN},createdAt:{type:u.STRING},updatedAt:{type:u.STRING},deleted:{type:u.BOOLEAN,defaultValue:!1}});e.exports=s},function(e,r){e.exports=require("sequelize")},function(e,r,t){var n=t(5);process.env;e.exports=new n("repassdb","postgres","nnnsss",{host:"localhost",dialect:"postgres",pool:{max:5,min:0,acquire:3e4,idle:1e3},define:{timestamps:!1},logging:!1})},function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function u(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){s(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function s(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var a=t(1),i=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.update(u({},t),{where:{name:r}});case 2:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(n,u){var s=e.apply(r,t);function a(e){o(s,n,u,a,i,"next",e)}function i(e){o(s,n,u,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=i},function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function u(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){s(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function s(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var a=t(4),i=t(0),c=t(2),p=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,s,o,p,f,l,v=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.length>2&&void 0!==v[2]?v[2]:0,e.next=3,a.update(u({},t),{where:{id:r}});case 3:return e.prev=3,e.next=6,a.findOne({where:{id:r}});case 6:return s=e.sent,o=s.user,e.next=10,i.findOne({where:{username:o}});case 10:return p=e.sent,f=p.karma||0,l=f+n,e.next=15,c(o,{karma:l});case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(3),console.log("couldn't change karma"),console.log(e.t0);case 21:case"end":return e.stop()}}),e,null,[[3,17]])})),function(){var r=this,t=arguments;return new Promise((function(n,u){var s=e.apply(r,t);function a(e){o(s,n,u,a,i,"next",e)}function i(e){o(s,n,u,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=p},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(0),s=function(e){e.header("Cache-Control","no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0")},o=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t,n){var o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o={err:"Error authenticating. Please login or register!"},r.session){e.next=4;break}return e.abrupt("return",t.status(403).send(o));case 4:if(r.session.user){e.next=6;break}return e.abrupt("return",t.status(403).send(o));case 6:return e.prev=6,a=r.session.user.username,e.next=10,u.findOne({where:{username:a}});case 10:if(!(i=e.sent)){e.next=19;break}if(!i.session_ids.split(",").some((function(e){return e===r.sessionID}))){e.next=18;break}return s(t),e.abrupt("return",n());case 18:r.session.destroy((function(e){e&&console.log(e)}));case 19:return e.abrupt("return",t.status(403).send(o));case 22:return e.prev=22,e.t0=e.catch(6),console.log("error checking authroization status",e.t0),e.abrupt("return",t.status(500).send({err:"Critical server error :("}));case 26:case"end":return e.stop()}}),e,null,[[6,22]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t,n){return r.apply(this,arguments)}}();e.exports=o},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(2),s=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=(n=t.session_ids)?n.split(","):[]).length>4&&n.pop(),n.unshift(r.sessionID),n=n.toString(),e.next=7,u(t.username,{session_ids:n});case 7:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=s},function(e,r){e.exports=function(e,r){e.session.user={},e.session.user.username=r.username}},function(e,r,t){t(13),e.exports=t(14)},function(e,r){e.exports=require("@babel/polyfill")},function(e,r,t){var n=t(15),u=process.env.PORT||5e3;n.listen(u,(function(){console.log("listening at port ".concat(u))}))},function(e,r,t){var n=t(3),u=t(6),s=t(16),o=t(17),a=t(18),i=t(19),c=t(20),p=t(21)(i),f=n(),l=t(22),v=t(23),d=a.join(__dirname,"../../client");t(58).config({path:a.resolve(__dirname,"/".concat("production".toLowerCase(),".env"))});var h=c.createClient();h.on("connect",(function(){console.log("Redis connected")})),f.use(n.json()),f.use(n.urlencoded({extended:!0})),f.use(s),f.use(o({credentials:!0,origin:!0})),f.use(i({genid:function(e){return l()},secret:"session_top_secret",saveUninitialized:!0,resave:!0,store:new p({client:h}),cookie:{secure:!1,maxAge:432e5}})),u.authenticate().then((function(){return console.log("Database connected")})).catch((function(e){return console.log(e)})),f.use(v),f.use(n.static(a.join(d,"dist"))),f.get("/*",(function(e,r){return r.sendFile(a.join(d,"dist/index.html"))})),e.exports=f},function(e,r){e.exports=function(e,r,t){r.header("Access-Control-Allow-Credentials: true"),r.header("Access-Control-Allow-Origin: *"),r.header("Access-Control-Allow-Headers: Origin, Content-Type, X-Auth-Token"),r.header("Access-Control-Allow-Methods: GET, POST, PATCH, PUT, DELETE, OPTIONS"),t()}},function(e,r){e.exports=require("cors")},function(e,r){e.exports=require("path")},function(e,r){e.exports=require("express-session")},function(e,r){e.exports=require("redis")},function(e,r){e.exports=require("connect-redis")},function(e,r){e.exports=require("uuid")},function(e,r,t){var n=t(3).Router(),u=t(24),s=t(29),o=t(38),a=t(44),i=t(55);n.use("/",i),n.use("/",u),n.use("/",a),n.use("/",s),n.use("/",o),n.use("",(function(e,r){return r.status(404).send("404 route")})),e.exports=n},function(e,r,t){var n=t(3).Router(),u=t(25),s=t(26),o=t(28);n.post("/login",u),n.post("/logout",s),n.post("/register",o),e.exports=n},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(0),s=t(10),o=t(11),a=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,a,i,c,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.body,a=n.username,i=n.password,a&&i){e.next=4;break}return c={err:"Please fill in all fields"},e.abrupt("return",t.status(403).send(c));case 4:return e.prev=4,e.next=7,u.findOne({where:{username:a,password:i}});case 7:if(p=e.sent){e.next=11;break}return f={err:"Wrong username or password"},e.abrupt("return",t.status(400).send(f));case 11:return e.next=13,s(r,p);case 13:return o(r,p),e.abrupt("return",t.status(200).send(p.username));case 17:return e.prev=17,e.t0=e.catch(4),console.log(e.t0),e.abrupt("return",t.status(500).send(":("));case 21:case"end":return e.stop()}}),e,null,[[4,17]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=a},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(0),s=t(27),o=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.session){e.next=2;break}return e.abrupt("return",t.status(400).send({err:"Already logged out!"}));case 2:if(!r.session.user){e.next=22;break}return e.prev=3,n=r.session.user.username,e.next=7,u.findOne({where:{username:n}});case 7:if(!(o=e.sent)){e.next=14;break}return e.next=11,s(r,o);case 11:return e.abrupt("return",t.status(200).send({msg:"Logged out"}));case 14:return e.abrupt("return",t.status(400).send({err:"Already logged out!"}));case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),t.status(500).send("something went wrong while trying to log out!");case 20:e.next=23;break;case 22:t.status(204).send({err:"Already logged out!"});case 23:case"end":return e.stop()}}),e,null,[[3,17]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=o},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(2),s=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session_ids,s=t.username,n=n.split(",").filter((function(e){return e!==r.sessionID})).toString(),e.next=5,u(s,{session_ids:n});case 5:r.session.destroy((function(e){if(e)return console.log(e)}));case 6:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=s},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(0),s=t(10),o=t(11),a=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,a,i,c,p,f,l,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.body,a=n.username,i=n.email,c=n.password,a&&c&&i){e.next=4;break}return p={err:"Please fill in all fields"},e.abrupt("return",t.status(403).send(p));case 4:return e.prev=4,e.next=7,u.findOne({where:{username:a}});case 7:if(!e.sent){e.next=11;break}return f={err:"Username taken!"},e.abrupt("return",t.status(409).send(f));case 11:return l={username:a,password:c,email:i,createdAt:(new Date).getTime().toString()},e.next=14,u.create(l);case 14:return v=e.sent,e.next=17,s(r,v);case 17:return o(r,v),e.abrupt("return",t.status(201).send(v.username));case 21:return e.prev=21,e.t0=e.catch(4),console.log(e.t0),e.abrupt("return",t.status(500).send("Server error while trying to register user"));case 25:case"end":return e.stop()}}),e,null,[[4,21]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=a},function(e,r,t){var n=t(3).Router(),u=t(30),s=t(31),o=t(32),a=t(34),i=t(35),c=t(36),p=t(9);n.get("/subs",u),n.post("/subs/create",p,o),n.get("/r/:sub/",s),n.post("/subscribe/:sub/",p,c),n.put("/r/:sub/",p,i),n.delete("/r/:sub/",p,a),e.exports=n},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(1),s=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.findAll();case 3:return n=e.sent,e.abrupt("return",t.status(201).send(n));case 7:return e.prev=7,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send("awkwarrrrd"));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=s},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(1),s=function(e){return!!(e.session&&e.session.user&&e.session.user.username)},o=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.body,o=n.batchNum,a=n.postsNum,o=o||0,a=a||20,e.prev=3,e.next=6,u.findOne({where:{name:r.params.sub}});case 6:if(!(i=e.sent)){e.next=11;break}return i.dataValues.isSubbed=!1,s(r)&&i.users&&i.users.length&&-1!==i.users.indexOf(r.session.user.username)&&(i.dataValues.isSubbed=!0),e.abrupt("return",t.status(200).send(i));case 11:return e.abrupt("return",t.status(404).send({err:"sub not found"}));case 14:return e.prev=14,e.t0=e.catch(3),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Server error"}));case 18:case"end":return e.stop()}}),e,null,[[3,14]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=o},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(1),s=t(33),o=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,o,a,i,c,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.body,o=n.name,a=n.description,o=o.trim(),a=a.trim(),i=r.session.user.username,e.next=7,u.findOne({where:{name:o}});case 7:if(!e.sent){e.next=11;break}return c={err:"Sub already exists"},e.abrupt("return",t.status(409).send(c));case 11:return(p={name:o,description:a,createdBy:i,mods:[],createdAt:(new Date).getTime().toString()}).mods.push(i),e.next=15,u.create(p);case 15:return e.next=17,s(p.name,i);case 17:return e.abrupt("return",t.status(201).send({msg:"Sub created"}));case 20:return e.prev=20,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send(":("));case 24:case"end":return e.stop()}}),e,null,[[0,20]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=o},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(0),s=t(1),o=t(7),a=t(2),i=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,i,c,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.findOne({where:{username:t}});case 3:return n=e.sent,e.next=6,s.findOne({where:{name:r}});case 6:return i=e.sent,-1===(c=i.mods||[]).indexOf(t)?c.push(t):c.splice(c.indexOf(t),1),e.next=11,o(r,{mods:c});case 11:return-1===(p=n.moderator||[]).indexOf(r)?p.push(r):p.splice(p.indexOf(r),1),e.next=15,a(t,{moderator:p});case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),console.log(e.t0);case 20:case"end":return e.stop()}}),e,null,[[0,17]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=i},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(1),s={err:"You're not authorized to delete this sub!"},o=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.params.sub,o=r.session.user.username,e.next=5,u.findOne({where:{name:n}});case 5:if(e.sent.createdBy===o){e.next=11;break}return console.log("not a mod"),e.abrupt("return",t.status(403).send(s));case 11:return console.log("deleting"),e.next=14,u.destroy({where:{name:n}});case 14:return e.abrupt("return",t.status(200).send({msg:"Deleted sub!"}));case 15:e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Server error trying to delete sub"}));case 21:case"end":return e.stop()}}),e,null,[[0,17]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=o},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(7),s=t(1),o=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,o,a,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.session.user.username,o=r.params.sub,a=r.body,i="You are not authenticated to make changes to the sub!",e.prev=4,e.next=7,s.findOne({where:{name:o}});case 7:if(c=e.sent){e.next=10;break}return e.abrupt("return",t.status(400).send({err:"Sub does not exist!"}));case 10:if(c.createdBy===n){e.next=12;break}return e.abrupt("return",t.status(403).send({err:i}));case 12:return e.next=14,u(o,{description:a.description});case 14:return e.abrupt("return",t.status(200).send({msg:"Edited sub"}));case 17:return e.prev=17,e.t0=e.catch(4),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Something went wrong. Server error"}));case 21:case"end":return e.stop()}}),e,null,[[4,17]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=o},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(37),s=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.session.user.username,s=r.params.sub.toString(),e.prev=2,e.next=5,u(n,s);case 5:return e.abrupt("return",t.status(200).send({msg:"Suscribed to "+s}));case 8:return e.prev=8,e.t0=e.catch(2),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Something went wrong."}));case 12:case"end":return e.stop()}}),e,null,[[2,8]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=s},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(0),s=t(1),o=t(2),a=t(7),i=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,i,c,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.findOne({where:{username:r}});case 2:return n=e.sent,-1===(i=n.subs||[]).indexOf(t)?(i.push(t),c=!0):(i.splice(i.indexOf(t),1),c=!1),e.next=7,o(r,{subs:i});case 7:return e.next=9,s.findOne({where:{name:t}});case 9:if(p=e.sent){e.next=12;break}throw new Error("No such sub as "+t+" to subscribe?");case 12:return f=p.users||[],c?f.push(r):f.splice(f.indexOf(r),1),e.next=16,a(t,{users:f});case 16:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=i},function(e,r,t){var n=t(3).Router(),u=t(39),s=t(40),o=t(41),a=t(42),i=t(43),c=t(9);n.get("/users/",u),n.get("/users/me",c,o),n.get("/u/:username/",s),n.put("/u/:username/edit",c,a),n.delete("/u/:username/delete",c,i),e.exports=n},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(0),s=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.findAll();case 2:n=e.sent,t.status(200).send(n);case 4:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=s},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(0),s=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.params.username,e.prev=1,e.next=4,u.findOne({where:{username:n}});case 4:if(!(s=e.sent)){e.next=9;break}return e.abrupt("return",t.status(201).send(s));case 9:return e.abrupt("return",t.status(404).send({err:"User not found"}));case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),console.log(e.t0),e.abrupt("return",t.status(500).send("server error"));case 16:case"end":return e.stop()}}),e,null,[[1,12]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=s},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(0),s=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.session.user.username,e.prev=1,e.next=4,u.findOne({where:{username:n}});case 4:if(s=e.sent){e.next=7;break}return e.abrupt("return",t.status(404).send({err:"User not found"}));case 7:return e.abrupt("return",t.status(200).send(s));case 10:return e.prev=10,e.t0=e.catch(1),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"server error"}));case 14:case"end":return e.stop()}}),e,null,[[1,10]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=s},function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function u(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){s(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function s(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var a=t(2),i=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.session.user.username,s=u({},r.query),e.next=5,a(n,u({},s));case 5:return e.abrupt("return",t.status(200).send({msg:"Edited user!"}));case 8:return e.prev=8,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Server error editing user :("}));case 12:case"end":return e.stop()}}),e,null,[[0,8]])})),function(){var r=this,t=arguments;return new Promise((function(n,u){var s=e.apply(r,t);function a(e){o(s,n,u,a,i,"next",e)}function i(e){o(s,n,u,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=i},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(0),s=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.session.user.username===r.params.username){e.next=2;break}return e.abrupt("return",t.status(403).send({err:"Cannot delete user. Not authenticated"}));case 2:return n=r.params.username,e.prev=3,e.next=6,u.destroy({where:{username:n}});case 6:return e.abrupt("return",t.status(200).send({msg:"Deleted user"}));case 9:e.prev=9,e.t0=e.catch(3),console.log(e.t0),t.status(500).send({err:"Couldn't delete user. Server error!"});case 13:case"end":return e.stop()}}),e,null,[[3,9]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=s},function(e,r,t){var n=t(3).Router(),u=t(45),s=t(46),o=t(49),a=t(50),i=t(51),c=t(54),p=t(9);n.post("/r/:sub/:id",p,s),n.post("/r/:sub/",p,s),n.post("/:id/vote/:type",p,i),n.put("/r/:sub/:id",p,o),n.get("/listing/:id/",u),n.get("/r/:sub/:id/",u),n.delete("/r/:sub/:id",p,a),n.delete("/:id",p,a),n.get("/listings/u/:username",c),n.get("/listings/r/:sub",c),e.exports=n},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}function u(e){return function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))}}var s=t(4),o=function(){var e=u(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r.parent){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,s.findOne({where:{id:r.originalPost}});case 5:if(e.sent.user!==r.user){e.next=8;break}return e.abrupt("return",!0);case 8:return e.abrupt("return",!1);case 11:return e.prev=11,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(r){return e.apply(this,arguments)}}(),a=function(){var e=u(regeneratorRuntime.mark((function e(r,t){var n,u,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.params.id,n=parseInt(n)||-999,e.next=5,s.findOne({where:{id:n}});case 5:if(u=e.sent){e.next=8;break}return e.abrupt("return",t.status(404).send({err:"Listing not found"}));case 8:return u.dataValues.vote=null,r.session&&r.session.user&&(a=r.session.user.username,u.ups&&-1!==u.ups.indexOf(a)&&(u.dataValues.vote=1),u.downs&&-1!==u.downs.indexOf(a)&&(u.dataValues.vote=0)),e.next=12,o(u);case 12:return i=e.sent,u.isThisOP=i,e.abrupt("return",t.status(200).send(u));case 17:return e.prev=17,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Server error while getting listing!"}));case 21:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(r,t){return e.apply(this,arguments)}}();e.exports=a},function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function u(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){s(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function s(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var a=t(47),i=t(48),c=function(e,r){return!("post"===r&&!e.title)&&!("comment"===r&&!e.body)},p=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t,n){var s,o,p,f,l,v,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.params,o=s.sub,p=s.id,f=r.body,l=[],console.log(f),o||l.push({err:"Paramaters not satisified"}),c(f,v=p?"comment":"post")){e.next=9;break}return l.push({err:"Please fill in all fields"}),e.abrupt("return",t.status(400).send(l));case 9:if(e.prev=9,d=r.session.user.username,f=u({},f,{sub:o,user:d,originalPost:p,createdAt:(new Date).getTime().toString(),ups:[d]}),"post"!==v){e.next=17;break}return e.next=15,i(f);case 15:e.next=20;break;case 17:return f.parent=p,e.next=20,a(f);case 20:return e.abrupt("return",t.status(201).send({msg:"Created listing!"}));case 23:return e.prev=23,e.t0=e.catch(9),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Server error! could not create listing"}));case 27:case"end":return e.stop()}}),e,null,[[9,23]])})),function(){var r=this,t=arguments;return new Promise((function(n,u){var s=e.apply(r,t);function a(e){o(s,n,u,a,i,"next",e)}function i(e){o(s,n,u,a,i,"throw",e)}a(void 0)}))});return function(e,t,n){return r.apply(this,arguments)}}();e.exports=p},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(0),s=t(2),o=t(4),a=t(8),i=function(){var e,r=(e=regeneratorRuntime.mark((function e(r){var t,n,i,c,p,f,l,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.user,n=r.parent,e.next=4,o.create(r);case 4:return i=e.sent,c=i.id,e.next=8,u.findOne({where:{username:t}});case 8:return p=e.sent,(f=p.listings||[]).unshift(c),e.next=13,s({listings:f},{where:{username:t}});case 13:return e.next=15,o.findOne({where:{id:n}});case 15:return l=e.sent,(v=l.children||[]).unshift(c),e.next=20,a(n,{children:v});case 20:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e){return r.apply(this,arguments)}}();e.exports=i},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(0),s=t(2),o=t(7),a=t(4),i=t(1),c=function(){var e,r=(e=regeneratorRuntime.mark((function e(r){var t,n,c,p,f,l,v,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.create(r);case 2:return t=e.sent,n=t.id,c=r.user,p=r.sub,e.next=8,u.findOne({where:{username:c}});case 8:return f=e.sent,(l=f.listings||[]).unshift(n),e.next=13,s(c,{listings:l});case 13:return e.next=15,i.findOne({where:{name:p}});case 15:if(v=e.sent){e.next=18;break}throw new Error("r/".concat(p," doesn't exist"));case 18:return(d=v.listings||[]).unshift(n),e.next=22,o(p,{listings:d});case 22:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e){return r.apply(this,arguments)}}();e.exports=c},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(4),s=t(8),o=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(n=r.body).updatedAt=(new Date).getTime().toString(),o=r.params.id,a=r.session.user.username,e.next=7,u.findOne({where:{id:o,user:a}});case 7:return e.sent||t.status(400).send({err:"Listing does not exist"}),e.next=11,s(o,n);case 11:return e.abrupt("return",t.status(201).send({msg:"Listing updated"}));case 14:return e.prev=14,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Could not edit listing"}));case 18:case"end":return e.stop()}}),e,null,[[0,14]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=o},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(8),s=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.session.user.username,n=r.params.id,e.prev=2,e.next=5,u(n,{deleted:!0});case 5:return e.abrupt("return",t.status(202).send({msg:"Deleted listing!"}));case 8:return e.prev=8,e.t0=e.catch(2),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Server error while deleting listing!"}));case 12:case"end":return e.stop()}}),e,null,[[2,8]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=s},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(52),s=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t,n){var s,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.session.user.username,o=r.params,a=o.id,"up"===(i=o.type)||"down"===i){e.next=4;break}return e.abrupt("return",n());case 4:return e.prev=4,e.next=7,u(a,s,i);case 7:return e.abrupt("return",t.status(200).send({msg:"Successfully voted!"}));case 10:return e.prev=10,e.t0=e.catch(4),console.log(e.t0),e.abrupt("return",t.status(500).send({err:"Could not vote"}));case 14:case"end":return e.stop()}}),e,null,[[4,10]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t,n){return r.apply(this,arguments)}}();e.exports=s},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var u=t(8),s=t(53),o=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t,n){var o,a,i,c,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s(r,t);case 2:return o=e.sent,a=o.self,i=o.downs||[],c=o.ups||[],p=0,1===a&&"up"===n?(p=-1,c.splice(c.indexOf(t),1)):0!==a&&null!==a||"up"!==n?0===a&&"down"===n?(p=1,i.splice(i.indexOf(t),1)):1!==a&&null!==a||"down"!==n||(p=null===a?-1:-2,c.splice(c.indexOf(t),1),i.push(t)):(p=null===a?1:2,c.push(t),i.splice(i.indexOf(t),1)),f=c.length-i.length,e.next=11,u(r,{ups:c,downs:i,score:f},p);case 11:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t,n){return r.apply(this,arguments)}}();e.exports=o},function(e,r,t){function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function u(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(t,!0).forEach((function(r){s(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function s(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var a=t(4),i=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,s,o,i,c,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.findOne({where:{id:r}});case 2:if(n=e.sent,s=n.downs||[],o=n.ups||[],i={ups:o,downs:s,total:o.length-s.length},t){e.next=8;break}return e.abrupt("return",i);case 8:if(c=-1!==s.indexOf(t),p=-1!==o.indexOf(t),!c){e.next=14;break}return e.abrupt("return",u({self:0},i));case 14:if(!p){e.next=18;break}return e.abrupt("return",u({self:1},i));case 18:return e.abrupt("return",u({self:null},i));case 19:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(n,u){var s=e.apply(r,t);function a(e){o(s,n,u,a,i,"next",e)}function i(e){o(s,n,u,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=i},function(e,r,t){function n(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}function u(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var s=t(4),o=t(5),a=function(e){var r=e.username,t=e.search,n=void 0===t?"":t,s=e.t,a=e.sub,i=e.page,c=s,p=20*((void 0===i?1:i)-1),f={where:{title:u({},o.Op.iLike,"%".concat(n,"%"))},attributes:["id"],limit:20,offset:p};if(c){var l=new Date;l.setHours(l.getHours()-24*c);var v=new Date;l=l.getTime().toString(),v=v.getTime().toString(),f.order=[["score","DESC"]],"all"!==c&&(f.where.createdAt=u({},o.Op.between,[l,v]))}else f.order=[["createdAt","DESC"]];return a&&"all"!==a?f.where.sub=a:r&&(f.where.user=r),f},i=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n,u,o,i,c,p,f,l,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.params,u=n.username,o=n.sub,i=r.query,c=i.t,p=i.search,f=i.page,l=a({username:u,sub:o,t:c,search:p,page:f}),e.next=6,s.findAll(l);case 6:if(e.t0=e.sent,e.t0){e.next=9;break}e.t0=[];case 9:return v=e.t0,e.abrupt("return",t.send(v));case 13:return e.prev=13,e.t1=e.catch(0),console.log(e.t1),e.abrupt("return",t.status(500).send({err:"server error"}));case 17:case"end":return e.stop()}}),e,null,[[0,13]])})),function(){var r=this,t=arguments;return new Promise((function(u,s){var o=e.apply(r,t);function a(e){n(o,u,s,a,i,"next",e)}function i(e){n(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=i},function(e,r,t){var n=t(3).Router(),u=t(56),s=t(57);n.get("/gettheme/",s),n.post("/changetheme/:theme",u),e.exports=n},function(e,r){function t(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var n=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.params.theme,r.session.theme=n,e.abrupt("return",t.status(200).send("changed theme"));case 6:e.prev=6,e.t0=e.catch(0),console.log(e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})),function(){var r=this,n=arguments;return new Promise((function(u,s){var o=e.apply(r,n);function a(e){t(o,u,s,a,i,"next",e)}function i(e){t(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=n},function(e,r){function t(e,r,t,n,u,s,o){try{var a=e[s](o),i=a.value}catch(e){return void t(e)}a.done?r(i):Promise.resolve(i).then(n,u)}var n=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.session.theme,e.abrupt("return",t.send(n));case 6:throw"Invalid theme falling back to default";case 7:e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",t.send("light"));case 13:case"end":return e.stop()}}),e,null,[[0,9]])})),function(){var r=this,n=arguments;return new Promise((function(u,s){var o=e.apply(r,n);function a(e){t(o,u,s,a,i,"next",e)}function i(e){t(o,u,s,a,i,"throw",e)}a(void 0)}))});return function(e,t){return r.apply(this,arguments)}}();e.exports=n},function(e,r){e.exports=require("dotenv")}]);